<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create â€¢ KAVNO</title>
<style>
body{background:#070707;color:white;font-family:Inter;margin:0}
.container{max-width:700px;margin:50px auto;background:#151515;padding:20px;border-radius:14px}
input,textarea{width:100%;margin-bottom:15px;padding:10px;border-radius:10px;border:none;background:#2a2a2a;color:white}
button{width:100%;padding:12px;border:none;border-radius:10px;background:#2a2a2a;color:white;cursor:pointer}
button:hover{background:linear-gradient(90deg,#dcdcdc,#8f8f8f);color:black}
.tabs{display:flex;gap:10px;margin-bottom:20px}
.tabs button{flex:1}
.active{background:linear-gradient(90deg,#dcdcdc,#8f8f8f)!important;color:black}
</style>
</head>
<body>

<div class="container">
<h2>Create</h2>

<div class="tabs">
<button id="postTab" class="active">Post</button>
<button id="klipTab">Klip</button>
</div>

<textarea id="text" placeholder="Write something..."></textarea>
<input type="file" id="file">

<button onclick="publish()">Publish</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, addDoc, collection, serverTimestamp }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBnT085eVcbqRiWG_ohyDFc6mShIqRcFOM",
  authDomain: "kavno-8e9ea.firebaseapp.com",
  projectId: "kavno-8e9ea",
  storageBucket: "kavno-8e9ea.firebasestorage.app",
  messagingSenderId: "978146900809",
  appId: "1:978146900809:web:15265ae75beca386353898"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* CLOUDINARY */
const CLOUD_NAME="dhsj2x1co";
const UPLOAD_PRESET="kavnoUploads";

let type="post";
document.getElementById("postTab").onclick=()=>type="post";
document.getElementById("klipTab").onclick=()=>type="klip";

window.publish=async()=>{
  const user=auth.currentUser;
  if(!user){ alert("Login first"); return; }

  let mediaURL="";
  const file=document.getElementById("file").files[0];

  if(file){
    const fd=new FormData();
    fd.append("file",file);
    fd.append("upload_preset",UPLOAD_PRESET);

    const res=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`,{
      method:"POST",
      body:fd
    });
    const data=await res.json();
    mediaURL=data.secure_url;
  }

  await addDoc(collection(db,"posts"),{
    username:user.displayName || "user",
    uid:user.uid,
    type,
    text:document.getElementById("text").value,
    mediaURL,
    score:0,
    createdAt:serverTimestamp()
  });

  location.href="index.html";
};

</script>
</body>
</html>
